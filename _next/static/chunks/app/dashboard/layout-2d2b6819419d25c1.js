(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1954],{19324:()=>{},19864:(e,r,o)=>{"use strict";o.d(r,{n:()=>t});let t=(0,o(12115).createContext)({displayName:"Usuario",updateDisplayName:()=>{}})},28151:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>g});var t=o(95155);o(19324);var s=o(6874),a=o.n(s),i=o(12115),l=o(35695),n=o(79971),c=o(55988);function d(e){let{children:r,requiredRole:o=null}=e,s=(0,l.useRouter)(),[a,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{if(!(0,n.getCookie)("token")){d(!1),s.push("/login");return}(async()=>{try{let e=await c.A.me();if(e.error)throw Error("Error al obtener informaci\xf3n del usuario");if((0,n.getCookie)("user")||(0,n.setCookie)("user",JSON.stringify(e.user),{maxAge:2592e3,path:"/"}),(0,n.getCookie)("empleado")||(0,n.setCookie)("empleado",JSON.stringify(e.empleado),{maxAge:2592e3,path:"/"}),(0,n.getCookie)("rol")||(0,n.setCookie)("rol",e.rol,{maxAge:2592e3,path:"/"}),o&&!(o&&o.includes(",")?o.split(",").map(e=>e.trim()):o?[o]:[]).some(e=>c.A.hasRole(e))){s.push("/dashboard/unauthorized"),d(!1);return}d(!0)}catch(e){console.error("Error de autenticaci\xf3n:",e),c.A.logoutClient(s),d(!1)}finally{m(!1)}})()},[s,o]),u)?(0,t.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-purple-500"})}):a?(0,t.jsx)(t.Fragment,{children:r}):null}var u=o(60807),m=o(19864),h=o(40857);function g(e){let{children:r}=e,o=(0,l.useRouter)(),s=(0,l.usePathname)(),a=(0,n.getCookie)("rol")||"Usuario",h=(0,n.getCookie)("user")?JSON.parse((0,n.getCookie)("user")):{name:"Usuario"},g=(0,n.getCookie)("empleado")?JSON.parse((0,n.getCookie)("empleado")):null,[f,k]=(0,i.useState)((null==g?void 0:g.nombre)||(null==h?void 0:h.name)||"Usuario"),[x,b]=(0,i.useState)(!1),[y,C]=(0,i.useState)(()=>"true"===localStorage.getItem("darkMode"));(0,i.useEffect)(()=>{y?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",y)},[y]);let j=async()=>{b(!0);try{await c.A.logout(),setTimeout(()=>c.A.logoutClient(o),350)}catch(e){console.error("Error al cerrar sesi\xf3n:",e),setTimeout(()=>c.A.logoutClient(o),1e3)}};return(0,t.jsx)(m.n.Provider,{value:{displayName:f,updateDisplayName:k},children:(0,t.jsx)(d,{children:(0,t.jsxs)("div",{className:"flex flex-col h-screen dark:bg-gray-900 dark:text-white",children:[(0,t.jsxs)("header",{className:"bg-[#8c52ff] dark:bg-[#6b3acb] h-16 flex items-center justify-between px-10 py-2",children:[(0,t.jsx)("img",{src:"/dashboard/logo.webp",className:"h-full",alt:"Logo"}),(0,t.jsxs)("h1",{className:"text-3xl text-white font-semibold",children:["SECCI\xd3N: ",s.slice(s.indexOf("/",1)+1,-1).toUpperCase()]})]}),(0,t.jsxs)("div",{className:"flex w-full overflow-hidden h-screen",children:[(0,t.jsxs)("div",{className:"flex flex-col shrink-0 p-2 bg-[#e8e8e8] dark:bg-gray-800 text-black dark:text-white justify-between",children:[(0,t.jsx)("nav",{className:"flex-1 overflow-y-auto mt-3 pr-1",children:(0,t.jsxs)("ul",{className:"flex flex-col gap-1",children:[(0,t.jsx)(p,{title:"Secci\xf3n Principal",href:"/dashboard/main"}),c.A.hasPermission("ver-empleados")&&(0,t.jsx)(p,{title:"Empleados",href:"/dashboard/empleados"}),c.A.hasPermission("ver-contactos")&&(0,t.jsx)(p,{title:"Contactanos",href:"/dashboard/contactanos"}),c.A.hasPermission("ver-modales")&&(0,t.jsx)(p,{title:"Modales",href:"/dashboard/modales"}),c.A.hasPermission("ver-reclamaciones")&&(0,t.jsx)(p,{title:"Reclamaciones",href:"/dashboard/reclamaciones"}),c.A.hasPermission("crear-blogs")&&(0,t.jsx)(p,{title:"Blogs",href:"/dashboard/blogs"}),c.A.hasRole("administrador")&&(0,t.jsx)(p,{title:"Roles y Permisos",href:"/dashboard/role-permission"})]})}),(0,t.jsx)("button",{onClick:()=>C(!y),className:"mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-black dark:text-white rounded-lg transition",children:y?"\uD83C\uDF19 Dark Mode":"☀️ Light Mode"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex mt-auto gap-2 items-center",children:[(0,t.jsx)(u.A,{className:"text-[#8c52ff] dark:text-[#6b3acb] w-[50px]"}),(0,t.jsxs)("p",{className:"font-bold",children:["Bienvenido",(0,t.jsxs)("span",{className:"font-normal block",children:[f," (",a,")"]})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("button",{onClick:j,disabled:x,className:"bg-[#ff037f] dark:bg-[#bf025f] text-white px-4 py-3 rounded-full my-3 transition-all duration-300 hover:bg-[#e0036f] dark:hover:bg-[#9c024d] disabled:opacity-70",children:x?(0,t.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,t.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cerrando sesi\xf3n..."]}):"Cerrar sesi\xf3n"})})]})]}),r]})]})})})}function p(e){let{href:r,title:o}=e,s=(0,l.usePathname)()===r;return(0,t.jsx)("li",{children:(0,t.jsxs)(a(),{href:r,className:"flex gap-2 items-center rounded-lg px-4 py-3 \n          hover:bg-gray-300 dark:hover:bg-gray-700 \n          ".concat(s?"bg-gray-400 dark:bg-gray-600 font-bold":""),children:[(0,t.jsx)(h.A,{className:"text-[#8c52ff] dark:text-[#6b3acb] w-[50px]"}),o]})})}},29249:(e,r,o)=>{Promise.resolve().then(o.bind(o,28151))},31670:(e,r,o)=>{"use strict";o.d(r,{A:()=>t});let t="https://back.digimediamkt.com"},55988:(e,r,o)=>{"use strict";o.d(r,{A:()=>n});var t=o(31670),s=o(79971);let a="".concat(t.A,"/api"),i=function(e,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t={path:"/",maxAge:86400,sameSite:"lax",...o};if("user"===e&&r&&"object"==typeof r){let o={id:r.id,name:r.name,email:r.email};(0,s.setCookie)(e,JSON.stringify(o),t);return}if("empleado"===e&&r&&"object"==typeof r){let o={id_empleado:r.id_empleado,nombre:r.nombre,apellido:r.apellido,email:r.email,id_rol:r.id_rol};(0,s.setCookie)(e,JSON.stringify(o),t);return}if("subtipoAdmin"===e&&r&&"object"==typeof r){let o={description:r.description,hierarchy:r.hierarchy};(0,s.setCookie)(e,JSON.stringify(o),t);return}let a="object"==typeof r?JSON.stringify(r):r;(0,s.setCookie)(e,a,t)},l={register:async e=>{try{let r=await fetch("".concat(a,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await r.json();if(!r.ok)throw Error(o.message||"Error en el registro");return o.user&&(0,s.setCookie)("user",JSON.stringify(o.user),{maxAge:86400}),o}catch(e){return console.error("Error en registro:",e),{error:!0,message:e.message}}},login:async e=>{try{let r=await fetch("".concat(a,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await r.json();if(console.log("Usuario autenticado: \n",o),!r.ok)throw Error(o.message||"Error en la autenticaci\xf3n");return i("token",o.token),i("user",o.user),o.empleado&&i("empleado",o.empleado),o.rol&&i("rol",o.rol),o.permisos&&i("permisos",o.permisos),o.empleado.subtipo_admin&&i("subtipoAdmin",o.empleado.subtipo_admin),o}catch(e){throw console.error("Error en login:",e),e}},logout:async()=>{try{let e=(0,s.getCookie)("token");if(!e)return{success:!0};let r=await fetch("".concat(a,"/logout"),{method:"POST",headers:{authorization:"Bearer ".concat(e)}}),o=await r.json();if(!r.ok)throw Error(o.message||"Error al cerrar sesi\xf3n");return l.clearAuthCookies(),o}catch(e){return console.error("Error en logout:",e),l.clearAuthCookies(),{error:!0,message:e.message}}},me:async()=>{try{let e=(0,s.getCookie)("token");if(!e)return null;let r=await fetch("".concat(a,"/me"),{method:"GET",headers:{authorization:"Bearer ".concat(e)}}),o=await r.json();if(!r.ok)throw 401===r.status&&l.clearAuthCookies(),Error(o.message||"Error al obtener informaci\xf3n del usuario");return o.user&&i("user",o.user),o.empleado&&i("empleado",o.empleado),o.rol&&i("rol",o.rol),o.permisos&&i("permisos",o.permisos),o}catch(e){return console.error("Error al obtener informaci\xf3n del usuario:",e),{error:!0,message:e.message}}},logoutClient:e=>{l.clearAuthCookies(),e&&e.push("/login")},clearAuthCookies:()=>{(0,s.deleteCookie)("token"),(0,s.deleteCookie)("user"),(0,s.deleteCookie)("empleado"),(0,s.deleteCookie)("rol"),(0,s.deleteCookie)("permisos"),(0,s.deleteCookie)("subtipoAdmin")},getCurrentUser:()=>{let e=(0,s.getCookie)("user");try{if(e)return"string"==typeof e?JSON.parse(e):e;return null}catch(e){return console.error("Error parsing user cookie:",e),null}},getCurrentEmpleado:()=>{let e=(0,s.getCookie)("empleado");try{if(e)return"string"==typeof e?JSON.parse(e):e;return null}catch(e){return console.error("Error parsing empleado cookie:",e),null}},getCurrentSubtipoAdmin:()=>{let e=(0,s.getCookie)("subtipoAdmin");try{if(e)return"string"==typeof e?JSON.parse(e):e;return null}catch(e){return console.error("Error parsing empleado cookie:",e),null}},getCurrentRole:()=>(0,s.getCookie)("rol")||null,getCurrentPermissions:()=>{let e=(0,s.getCookie)("permisos");try{return e?JSON.parse(e):[]}catch(e){return[]}},getToken:()=>(0,s.getCookie)("token"),hasRole:e=>{let r=l.getCurrentRole();return!!r&&r.toLowerCase()===e.toLowerCase()},hasPermission:e=>l.getCurrentPermissions().includes(e),hasAnyPermission:e=>{let r=l.getCurrentPermissions();return e.some(e=>r.includes(e))},isAdmin:()=>l.hasRole("administrador"),isAuthenticated:()=>!!(0,s.getCookie)("token"),refreshAuthData:async()=>await l.me(),isVerifiedAccount:()=>{let e=l.getCurrentUser();return(null==e?void 0:e.email)==="tmlighting@hotmail.com"}},n=l}},e=>{var r=r=>e(e.s=r);e.O(0,[2533,9971,6874,6297,8441,1684,7358],()=>r(29249)),_N_E=e.O()}]);